---
output: rmarkdown::github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

# BRIWECS_Data_Publication

## A collaborative work on a data publication for the seasons 2015â€“2019 of the BRIWECS consortium

[![Website - pkgdown](https://img.shields.io/badge/data-overview-blue)](https://tillrose.github.io/BRIWECS_Data_Publication/data_overview.html) [![Project-website](https://img.shields.io/badge/Project-website-darkgreen)](https://www.igps.uni-hannover.de/de/forschung/forschungsprojekte/detailansicht/projects/forschungsverbund-briwecs)
<!-- [![License: GPL-3](https://img.shields.io/badge/License-GPL3-orange)](https://www.r-project.org/Licenses/) -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressWarnings(library(dplyr));
# suppressWarnings(library(ggplot2));
library(kableExtra);library(knitr);library(toolPhD)
# library(data.tree);
library(igraph)
suppressWarnings(library(tidygraph))
suppressWarnings(library(ggraph))
options(dplyr.summarise.inform = FALSE)
unit<- xlsx::read.xlsx("./metadata/Unit.xlsx",sheetIndex = 1) %>%
  mutate(unit=gsub('\\#','Nbr ',unit),
         unit=gsub('\\*',' x ',unit),
         unit=ifelse(is.na(unit),' ',unit)
         )

raw <- read.csv2("./output/BRIWECS_data_publication.csv") %>% 
  mutate(across(BBCH59:Protein_yield,as.numeric))
long <- raw  %>% 
  tidyr::pivot_longer(BBCH59:Protein_yield,
                      names_to="trait",values_to = "Trait") %>% 
  filter(!is.na(Trait)) 
tbl <- long %>%
left_join(unit ,by='trait')%>%
  view_group(.,"trait",c('Full.name',"Trait","unit")) 
```

![](https://github.com/tillrose/BRIWECS_Data_Publication/blob/main/figure/BRIWECS_logo.png){fig-align="right"}
```{r,echo=F,fig.width=14, fig.height=10,warning=F}
dirs <- list.dirs(path = ".", full.names = TRUE, recursive = TRUE) 

r.target <- paste(c(".git",".Rproj.user",".quarto","gfm","docs"),
                  collapse='|')
dirs <- dirs[!grepl(r.target,dirs)]

e.target <- c("./data","./figure",
              "./metadata","./output","./scripts")
dirs <- 
  purrr::map(e.target,~{
    list.files(.x,all.files = T,recursive = T,full.names = T)
  }) %>% Reduce(x = .,"c")  %>% 
  c(.,dirs)

dirst <- gsub("\\.\\/","Root/",dirs)

x <- lapply(strsplit(dirst, "/"), 
            function(z) as.data.frame(t(z))) %>% 
  plyr::rbind.fill(.) %>%
  filter(!is.na(V2)) %>% 
  group_by(V1,V2,V3) %>%
  reframe(V4 = case_when(n() > 8~sprintf("%s files",n()),
                           T~V4)) %>% 
  mutate(V2=factor(V2,levels=c("data","metadata","scripts","output","figure"))) %>% 
  arrange(desc(V2)) %>% suppressWarnings()

x$pathString <- apply(x, 1, function(x) paste(trimws(na.omit(x)), collapse="/"))

do.call('rbind', 
        strsplit(x$pathString, '/') %>%
  lapply(function(a) sapply(seq_along(a),
                            function(y) paste(a[1:y], collapse = '/'))) %>% 
  lapply(function(b) cbind(head(b, -1), tail(b, -1)))
) %>% 
  as.data.frame() %>%
  unique() %>%
  graph_from_data_frame() %>%
  as_tbl_graph() %>%
  mutate(label = gsub('^.*/(.*)$', '\\1', name)) %>%
  ggraph(layout = 'tree') + 
  geom_edge_diagonal(color = 'gray') +
  geom_node_point(shape = 21, size=3,fill = 'orange') +
  geom_node_text(aes(label = label), size = 3.1, nudge_x = 0.5) +
  coord_flip(clip = 'off') +
  scale_y_reverse() +
  theme_graph()

```

```{r,echo=F}


names(tbl)[1:3]<-c('trait name','full name','trait range') 

tbl%>%
  kbl(caption = "Table1. trait name, range and unit") %>%
  kable_classic_2(full_width = F, position = "float_right")


```



![](https://github.com/tillrose/BRIWECS_Data_Publication/blob/main/figure/fig1.png){fig-align="center"}

![](https://github.com/tillrose/BRIWECS_Data_Publication/blob/main/figure/data_point.png){fig-align="center"}
